{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* --- Estilos Profesionales Actualizados --- */
    :root {
        --bg-body: #f4f6f9;
        --card-border: #e9ecef;
        --text-muted: #6c757d;
        --edu-primary: #0d6efd;
    }

    body { background-color: var(--bg-body); }

    .edit-profile-header {
        background: white;
        border-bottom: 1px solid var(--card-border);
        padding: 2rem 0;
        margin-bottom: 2rem;
    }

    .form-section-card {
        background: white;
        border: 1px solid var(--card-border);
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.02);
    }

    .section-title {
        color: #2c3e50;
        font-weight: 700;
        font-size: 1.1rem;
        margin-bottom: 1.5rem;
        border-bottom: 2px solid #f0f2f5;
        padding-bottom: 10px;
        display: flex;
        align-items: center;
    }

    .section-title i {
        color: var(--edu-primary);
        margin-right: 10px;
        background: rgba(13, 110, 253, 0.1);
        padding: 8px;
        border-radius: 6px;
    }

    /* --- Estilos de Portada y Avatar --- */
    .cover-upload-preview {
        width: 100%;
        height: 180px;
        background-color: #dee2e6;
        border-radius: 8px;
        object-fit: cover;
        margin-bottom: 10px;
        border: 2px dashed #adb5bd;
    }

    .avatar-upload-preview {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        margin-top: -60px; /* Efecto superpuesto */
        background-color: #6c757d;
        position: relative;
        z-index: 2;
    }
    
    .avatar-placeholder-text {
        width: 120px;
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        color: white;
        background: #6c757d;
        border-radius: 50%;
        border: 4px solid white;
        margin-top: -60px;
        position: relative;
        z-index: 2;
    }

    .form-label { font-weight: 600; font-size: 0.9rem; color: #495057; }
    .form-text { font-size: 0.8rem; color: var(--text-muted); }
</style>

<div class="edit-profile-header">
    <div class="container">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h2 class="fw-bold mb-1">Editar Perfil</h2>
                <p class="text-muted mb-0">Personaliza tu portada, foto y datos.</p>
            </div>
            <a href="{% url 'ver_perfil_social' username=user.username %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Volver
            </a>
        </div>
    </div>
</div>

<div class="container pb-5">
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="row">
            <div class="col-lg-4">
                <div class="form-section-card text-center p-0 overflow-hidden">
                    <div class="p-3 bg-light border-bottom">
                        <h5 class="mb-0 fw-bold">Imágenes de Perfil</h5>
                    </div>
                    
                    <div class="p-3">
                        <label class="form-label w-100 text-start">Foto de Portada</label>
                        {% if user.perfil.foto_portada %}
                            <img src="{{ user.perfil.foto_portada.url }}" class="cover-upload-preview" alt="Portada actual">
                        {% else %}
                            <div class="cover-upload-preview d-flex align-items-center justify-content-center text-muted">
                                <span><i class="fas fa-image me-1"></i> Sin portada</span>
                            </div>
                        {% endif %}
                        <div class="mb-4">
                            {{ profile_form.foto_portada }}
                            <div class="form-text text-start">Recomendado: 1100x350 px.</div>
                        </div>

                        <div class="d-flex justify-content-center mb-3">
                            {% if user.perfil.foto_perfil %}
                                <img src="{{ user.perfil.foto_perfil.url }}" class="avatar-upload-preview" alt="Avatar">
                            {% else %}
                                <div class="avatar-placeholder-text">
                                    {{ user.username|slice:":1"|upper }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <label class="form-label w-100 text-center">Foto de Perfil</label>
                        <div class="mb-2">
                            {{ profile_form.foto_perfil }}
                        </div>
                    </div>
                </div>

                <div class="form-section-card">
                    <h5 class="section-title"><i class="fas fa-user-shield"></i> Datos de Cuenta</h5>
                    <div class="mb-3">
                        <label class="form-label">Nombre</label>
                        {{ user_form.first_name }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Apellido</label>
                        {{ user_form.last_name }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        {{ user_form.email }}
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                
                <div class="form-section-card">
                    <h5 class="section-title"><i class="fas fa-pen-fancy"></i> Presentación</h5>
                    <div class="mb-3">
                        <label class="form-label">Biografía / Sobre mí</label>
                        {{ profile_form.biografia }}
                    </div>
                </div>

                <div class="form-section-card">
                    <h5 class="section-title"><i class="fas fa-heart"></i> Gustos e Intereses</h5>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-gamepad me-1 text-muted"></i> Hobbies</label>
                        {{ profile_form.hobbies }}
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-music me-1 text-muted"></i> Música</label>
                            {{ profile_form.gustos_musicales }}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-book me-1 text-muted"></i> Libros</label>
                            {{ profile_form.libros_favoritos }}
                        </div>
                    </div>
                </div>

                <div class="form-section-card">
                    <h5 class="section-title"><i class="fas fa-graduation-cap"></i> Académico</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Materia Favorita</label>
                            {{ profile_form.materia_favorita }}
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Metas del Año</label>
                            {{ profile_form.metas_anio }}
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end gap-3 mt-4">
                    <a href="{% url 'ver_perfil_social' username=user.username %}" class="btn btn-outline-secondary px-4">Cancelar</a>
                    <button type="submit" class="btn btn-primary px-5 fw-bold">
                        <i class="fas fa-save me-2"></i> Guardar Cambios
                    </button>
                </div>

            </div>
        </div>
        
        {% if user_form.errors or profile_form.errors %}
            <div class="alert alert-danger mt-3">
                <strong><i class="fas fa-exclamation-circle"></i> Por favor corrige los errores.</strong>
            </div>
        {% endif %}
    </form>
</div>
{% endblock %}