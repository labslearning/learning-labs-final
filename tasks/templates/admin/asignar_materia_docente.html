{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    <div class="card p-5 shadow-lg">
        <h1 class="text-center mb-4">Gestión de Asignación de Materias</h1>
        <p class="lead text-center">
            Administra las materias y asigna docentes a los cursos y materias correspondientes.
        </p>
        <hr>

        <h3 class="mt-4 mb-3 text-primary">Crear Nueva Materia</h3>
        <form method="POST" action="{% url 'asignar_materia_docente' %}" class="mb-5">
            {% csrf_token %}
            <input type="hidden" name="crear_materia">
            <div class="row g-3">
                <div class="col-md-5">
                    <label for="nombre_materia" class="form-label">Nombre de la Materia</label>
                    <input type="text" class="form-control" id="nombre_materia" name="nombre" required>
                </div>
                <div class="col-md-5">
                    <label for="curso_materia" class="form-label">Curso</label>
                    <select class="form-select" id="curso_materia" name="curso_id" required>
                        <option value="">Selecciona un curso</option>
                        {% for curso in cursos %}
                            <option value="{{ curso.id }}">{{ curso.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Crear Materia</button>
                </div>
            </div>
        </form>

        <h3 class="mt-4 mb-3 text-success">Asignar Docente a Materia</h3>
        <form method="POST" action="{% url 'asignar_materia_docente' %}">
            {% csrf_token %}
            <input type="hidden" name="asignar_docente">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="docente_asignar" class="form-label">Docente</label>
                    <select class="form-select" id="docente_asignar" name="docente_id" required>
                        <option value="">Selecciona un docente</option>
                        {% for docente in docentes %}
                            <option value="{{ docente.id }}">{{ docente.get_full_name|default:docente.username }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="curso_asignar" class="form-label">Curso</label>
                    <select class="form-select" id="curso_asignar" name="curso_id" required>
                        <option value="">Selecciona un curso</option>
                        {% for curso in cursos %}
                            <option value="{{ curso.id }}">{{ curso.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="materia_asignar" class="form-label">Materia</label>
                    <select class="form-select" id="materia_asignar" name="materia_id" required>
                        <option value="">Selecciona una materia</option>
                        {% for materia in materias %}
                            <option value="{{ materia.id }}">{{ materia.nombre }} ({{ materia.curso.nombre }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-12 mt-4">
                    <button type="submit" class="btn btn-success w-100">Asignar Docente</button>
                </div>
            </div>
        </form>

        <h3 class="mt-5 mb-3 text-secondary">Asignaciones Existentes</h3>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Docente</th>
                        <th>Materia</th>
                        <th>Curso</th>
                    </tr>
                </thead>
                <tbody>
                    {% for asignacion in asignaciones %}
                    <tr>
                        <td>{{ asignacion.docente.get_full_name|default:asignacion.docente.username }}</td>
                        <td>{{ asignacion.materia.nombre }}</td>
                        <td>{{ asignacion.curso.nombre }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="text-center">No hay asignaciones de materias registradas.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>
{% endblock %}