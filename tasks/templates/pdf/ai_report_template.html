<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Informe Pedag√≥gico Institucional</title>
    <style>
        /* === CONFIGURACI√ìN DE P√ÅGINA E IMPRESI√ìN === */
        @page {
            size: A4;
            margin-top: 3cm;
            margin-bottom: 3cm;
            margin-left: 2.5cm;
            margin-right: 2.5cm;

            @top-center {
                content: element(header);
            }
            @bottom-center {
                content: element(footer);
            }
        }

        /* === TIPOGRAF√çA Y COLORES === */
        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            color: #2c3e50; /* Gris oscuro elegante */
            font-size: 11pt;
            line-height: 1.5;
            text-align: justify;
        }

        /* Paleta de Colores Institucional */
        :root {
            --primary: #003366; /* Azul Oscuro Acad√©mico */
            --accent: #b71c1c;  /* Rojo Institucional sutil */
            --light: #f4f6f7;   /* Gris muy claro para fondos */
            --border: #dcdde1;
        }

        /* === ENCABEZADO (Repetido en cada p√°gina) === */
        .header-container {
            position: running(header);
            width: 100%;
            border-bottom: 3px double var(--primary);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .header-table { width: 100%; border-collapse: collapse; }
        
        .logo-cell { 
            width: 20%; 
            vertical-align: middle; 
            text-align: left;
        }
        .logo-img { 
            height: 80px; 
            width: auto;
            object-fit: contain; 
        }
        
        .info-cell { 
            width: 80%; 
            text-align: right; 
            vertical-align: middle; 
        }
        .school-name {
            font-size: 15pt;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            margin: 0;
            letter-spacing: 0.5px;
        }
        .school-legal {
            font-size: 7.5pt;
            color: #555;
            margin-top: 4px;
            line-height: 1.2;
        }

        /* === PIE DE P√ÅGINA === */
        .footer-container {
            position: running(footer);
            width: 100%;
            border-top: 1px solid var(--border);
            padding-top: 8px;
            font-size: 8pt;
            color: #7f8c8d;
            text-align: center;
        }

        /* === MARCA DE AGUA (Fondo Institucional) === */
        .watermark {
            position: fixed;
            top: 35%;
            left: 25%;
            width: 50%;
            opacity: 0.05; /* Muy sutil para no estorbar lectura */
            z-index: -1000;
            transform: rotate(-30deg);
            filter: grayscale(100%);
        }

        /* === T√çTULO DEL DOCUMENTO === */
        .doc-title {
            text-align: center;
            margin-top: 10px;
            margin-bottom: 25px;
        }
        .doc-title h2 {
            font-size: 14pt;
            color: var(--primary);
            text-transform: uppercase;
            background-color: var(--light);
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            border: 1px solid var(--border);
        }

        /* === TABLA DE METADATOS (Estudiante) === */
        .meta-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            font-size: 10pt;
        }
        .meta-table td {
            padding: 6px 10px;
            border: 1px solid var(--border);
        }
        .label {
            font-weight: bold;
            color: var(--primary);
            width: 20%;
            background-color: #f0f3f5;
            text-transform: uppercase;
            font-size: 9pt;
        }
        .value {
            width: 30%;
        }
        .full-width {
            width: 80%;
        }

        /* === CONTENIDO DEL REPORTE (Markdown renderizado) === */
        .content-body {
            min-height: 400px;
        }
        .content-body h1, .content-body h2 {
            color: var(--primary);
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-top: 25px;
            font-size: 13pt;
        }
        .content-body h3 {
            color: #444;
            font-size: 12pt;
            margin-top: 15px;
            font-weight: bold;
        }
        .content-body ul { margin-left: 15px; padding-left: 15px; }
        .content-body li { margin-bottom: 4px; }
        .content-body strong { color: #000; font-weight: 700; }
        .content-body p { margin-bottom: 10px; }

        /* === ZONA DE FIRMAS (Al final) === */
        .signatures-wrapper {
            margin-top: 60px;
            page-break-inside: avoid;
            width: 100%;
        }
        .sig-table { width: 100%; margin-top: 40px; }
        .sig-cell {
            width: 40%;
            text-align: center;
            vertical-align: top;
        }
        .sig-line {
            border-top: 1px solid #000;
            margin: 0 30px 5px 30px;
        }
        .sig-name {
            font-weight: bold;
            font-size: 10pt;
            text-transform: uppercase;
        }
        .sig-role {
            font-size: 9pt;
            color: #666;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    {% if institucion.logo %}
        <img src="{{ institucion.logo.path }}" class="watermark">
    {% endif %}

    <div class="header-container">
        <table class="header-table">
            <tr>
                <td class="logo-cell">
                    {% if institucion.logo %}
                        <img src="{{ institucion.logo.path }}" class="logo-img">
                    {% else %}
                        <div style="font-size: 30pt; color: #ccc;">üèõÔ∏è</div>
                    {% endif %}
                </td>
                <td class="info-cell">
                    <h1 class="school-name">{{ institucion.nombre|default:"INSTITUCI√ìN EDUCATIVA" }}</h1>
                    <div class="school-legal">
                        NIT: {{ institucion.nit|default:"800.000.000-0" }} | DANE: {{ institucion.dane|default:"123456789012" }}<br>
                        Resoluci√≥n de Aprobaci√≥n No. {{ institucion.resolucion|default:"0000" }} del {{ institucion.fecha_resolucion|default:"01/01/2020" }}<br>
                        {{ institucion.direccion|default:"Direcci√≥n Institucional" }} | {{ institucion.telefono|default:"Tel√©fono Oficial" }}<br>
                        {{ institucion.email|default:"contacto@institucion.edu.co" }}
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <div class="footer-container">
        Documento oficial generado por la Plataforma Educativa Learning Labs. <br>
        La informaci√≥n contenida es de car√°cter pedag√≥gico y confidencial.<br>
        P√°gina <span style="content: counter(page)"></span> de <span style="content: counter(pages)"></span>
    </div>

    <div class="doc-title">
        <h2>INFORME DE AN√ÅLISIS ESTRAT√âGICO I.A.</h2>
    </div>

    <table class="meta-table">
        <tr>
            <td class="label">ESTUDIANTE:</td>
            <td class="value"><strong>{{ objetivo.get_full_name|default:objetivo.username|upper }}</strong></td>
            <td class="label">IDENTIFICACI√ìN:</td>
            <td class="value">{{ objetivo.username }}</td> </tr>
        <tr>
            <td class="label">SOLICITADO POR:</td>
            <td class="value">{{ solicitante.get_full_name|title }}</td>
            <td class="label">CARGO/ROL:</td>
            <td class="value">{{ solicitante.perfil.rol|title }}</td>
        </tr>
        <tr>
            <td class="label">TIPO DE AN√ÅLISIS:</td>
            <td class="value">{{ tipo_reporte }}</td>
            <td class="label">FECHA EMISI√ìN:</td>
            <td class="value">{{ fecha_impresion|date:"d/m/Y - h:i A" }}</td>
        </tr>
        {% if query_original %}
        <tr>
            <td class="label">FOCO / TEMA:</td>
            <td colspan="3" class="full-width"><em>"{{ query_original }}"</em></td>
        </tr>
        {% endif %}
    </table>

    <div class="content-body">
        {{ contenido_html }}
    </div>

    <div class="signatures-wrapper">
        <table class="sig-table">
            <tr>
                <td class="sig-cell">
                    <div style="height: 50px;"></div> <div class="sig-line"></div>
                    <div class="sig-name">{{ solicitante.get_full_name|default:solicitante.username|upper }}</div>
                    <div class="sig-role">PROFESIONAL RESPONSABLE</div>
                </td>
                <td style="width: 20%;"></td> <td class="sig-cell">
                    <div style="height: 50px;"></div> <div class="sig-line"></div>
                    <div class="sig-name">COORDINACI√ìN / ACUDIENTE</div>
                    <div class="sig-role">RECIBIDO / VISTO BUENO</div>
                </td>
            </tr>
        </table>
    </div>

    <div style="margin-top: 30px; font-size: 7pt; color: #999; text-align: center;">
        * Este reporte contiene sugerencias generadas mediante Inteligencia Artificial y debe ser validado por el criterio del profesional a cargo.
    </div>

</body>
</html>